<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonic Shooters</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a0033 0%, #0ff 100%);
            font-family: 'Press Start 2P', Arial, sans-serif;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background: #111122;
            border: 4px solid #0ff;
            box-shadow: 0 0 40px #0ff, 0 0 10px #fff inset;
            border-radius: 18px;
            overflow: hidden;
        }
        #game-canvas {
            width: 100%;
            height: 100%;
            background: url('imgsK/background.gif') no-repeat center center; /* Cambiado a la imagen de fondo */
            background-size: cover; /* Asegura que la imagen cubra todo el canvas */
            display: block;
        }
        #score {
            position: absolute;
            top: 18px;
            right: 18px;
            color: #0ff;
            font-size: 18px;
            text-shadow: 0 0 8px #0ff, 0 0 2px #fff;
            letter-spacing: 2px;
        }
        #lives {
            position: absolute;
            top: 18px;
            left: 18px;
            color: #f0f;
            font-size: 18px;
            text-shadow: 0 0 8px #f0f, 0 0 2px #fff;
            letter-spacing: 2px;
        }
        #game-over, #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 0, 40, 0.92);
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 18px;
            box-shadow: 0 0 30px #0ff inset;
        }
        #game-over { display: none; }
        button {
            background: linear-gradient(90deg, #0ff 0%, #f0f 100%);
            border: 2px solid #fff;
            color: #111122;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 8px;
            font-family: 'Press Start 2P', Arial, sans-serif;
            box-shadow: 0 0 10px #0ff, 0 0 2px #fff;
            transition: background 0.2s, color 0.2s;
        }
        button:hover {
            background: linear-gradient(90deg, #f0f 0%, #0ff 100%);
            color: #fff;
        }
        h1 {
            color: #f0f;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #f0f, 0 0 2px #fff;
            font-size: 2.2em;
            letter-spacing: 2px;
        }
        p {
            font-size: 1em;
            color: #0ff;
            text-shadow: 0 0 4px #0ff;
            text-align: center;
            line-height: 1.5;
            margin: 10px 20px;
        }
        #back-arrow {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #0ff;
            font-size: 36px;
            text-decoration: none;
            text-shadow: 0 0 10px #0ff, 0 0 4px #fff;
            z-index: 9999; /* Siempre encima del canvas */
            transition: transform 0.2s, color 0.2s;
        }
        #back-arrow:hover {
            transform: scale(1.2);
            color: #f0f;
        }

    </style>
</head>
<body>
    <a href="../index.html" id="back-arrow">&#8592;</a>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="score">Puntuación: 0</div>
        <div id="lives">Vidas: 3</div>
        <div id="game-over">
            <h1>Game Over</h1>
            <p id="final-score">Puntuación: 0</p>
            <button id="restart-button">Jugar de nuevo</button>
        </div>
        <div id="start-screen">
            <h1>Sonic Shooters</h1>
            <p>Usa las flechas arriba/abajo para moverte y la barra espaciadora para disparar</p>
            <p>¡Los enemigos vienen de derecha a izquierda!</p>
            <button id="start-button">Comenzar</button>
        </div>
    </div>

    <script>
        // Variables del juego
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const livesDisplay = document.getElementById('lives');
        const finalScoreDisplay = document.getElementById('final-score');
        const gameOverScreen = document.getElementById('game-over');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        
        // Variables para movimiento continuo
        let upPressed = false;
        let downPressed = false;
        
        // Ajustar tamaño del canvas
        canvas.width = 800;
        canvas.height = 600;
        
        // Variables del juego
        let player, enemies, bullets, gameInterval, enemyInterval, score, gameActive, lives;
        let floatingMessages = []; // Array para mensajes flotantes
        
        // Inicializar el juego
        function initGame() {
            player = {
                x: 30,
                y: canvas.height / 2 - 10,
                width: 150,
                height: 70,
                speed: 5,
                color: '#4CAF50'
            };
            
            enemies = [];
            bullets = [];
            score = 0;
            lives = 3;
            gameActive = true;
            
            scoreDisplay.textContent = `Puntuación: ${score}`;
            livesDisplay.textContent = `Vidas: ${lives}`;
            gameOverScreen.style.display = 'none';
            
            // Crear enemigos iniciales
            createEnemies();
            
            // Iniciar bucles del juego
            clearInterval(gameInterval);
            clearInterval(enemyInterval);
            
            gameInterval = setInterval(updateGame, 16); // ~60 FPS
            enemyInterval = setInterval(createEnemy, 1500); // Crear enemigo cada 1.5 segundos
        }
        
        // Crear enemigos iniciales
        function createEnemies() {
            for (let i = 0; i < 5; i++) {
                createEnemy();
            }
        }
        
        // Cargar sprite de enemigo
        const enemyImg = new Image();
        enemyImg.src = 'imgsK/giphyV.gif';
        // Crear un nuevo enemigo
        function createEnemy() {
            if (!gameActive) return;
            // Sprite cuadrado más grande
            const size = Math.random() * 40 + 60;
            const enemy = {
                x: canvas.width + size,
                y: Math.random() * (canvas.height - size),
                width: size,
                height: size,
                speed: Math.random() * 3 + 2
            };
            // Asegurar que el enemigo no salga del canvas por abajo
            if (enemy.y + size > canvas.height) {
                enemy.y = canvas.height - size;
            }
            enemies.push(enemy);
        }
        
        // Actualizar el estado del juego
        function updateGame() {
            if (!gameActive) return;
            
            // Movimiento continuo del jugador
            if (upPressed && player.y > 0) {
                player.y -= player.speed;
            }
            if (downPressed && player.y + player.height < canvas.height) {
                player.y += player.speed;
            }
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dibujar jugador
            drawPlayer();
            
            // Actualizar y dibujar enemigos
            updateEnemies();
            
            // Actualizar y dibujar balas
            updateBullets();
            
            // Dibujar mensajes flotantes
            drawFloatingMessages();
            
            // Comprobar colisiones
            checkCollisions();
        }
        
        // Cargar sprite del jugador
        const playerImg = new Image();
        playerImg.src = 'imgsK/sonknk.png';
        // Dibujar al jugador
        function drawPlayer() {
            ctx.save();
            ctx.shadowColor = '#0ff';
            ctx.shadowBlur = 18;
            // Dibujar sprite del jugador centrado en el área del jugador
            ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            ctx.restore();
        }
        
        // Actualizar enemigos
        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                // Mover enemigo (de derecha a izquierda)
                enemy.x -= enemy.speed;
                // Dibujar sprite de enemigo
                ctx.save();
                ctx.shadowColor = '#f0f';
                ctx.shadowBlur = 16;
                ctx.drawImage(enemyImg, enemy.x, enemy.y, enemy.width, enemy.height);
                ctx.restore();
                // Verificar colisión con el jugador
                if (
                    enemy.x < player.x + player.width &&
                    enemy.x + enemy.width > player.x &&
                    enemy.y < player.y + player.height &&
                    enemy.y + enemy.height > player.y
                ) {
                    enemies.splice(i, 1);
                    loseLife();
                    break;
                }
                // Eliminar enemigos que salen de la pantalla por la izquierda
                if (enemy.x + enemy.width < 0) {
                    enemies.splice(i, 1);
                }
            }
        }
        
        // Actualizar balas
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Mover bala (de izquierda a derecha)
                bullet.x += bullet.speed;
                
                // Dibujar bala retro
                ctx.save();
                ctx.shadowColor = '#0ff';
                ctx.shadowBlur = 10;
                ctx.fillStyle = '#fff';
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                ctx.restore();
                
                // Borde neón
                ctx.save();
                ctx.strokeStyle = '#0ff';
                ctx.lineWidth = 1;
                ctx.strokeRect(bullet.x, bullet.y, bullet.width, bullet.height);
                ctx.restore();
                
                // Eliminar balas que salen de la pantalla
                if (bullet.x > canvas.width) {
                    bullets.splice(i, 1);
                }
            }
        }
        
        // Comprobar colisiones
        function checkCollisions() {
            // Comprobar colisiones entre balas y enemigos
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const enemy = enemies[j];
                    
                    if (
                        bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y
                    ) {
                        // Colisión detectada
                        enemies.splice(j, 1);
                        bullets.splice(i, 1);
                        
                        // Aumentar puntuación
                        const points = Math.floor(100 - enemy.width / 2);
                        score += points;
                        scoreDisplay.textContent = `Puntuación: ${score}`;
                        
                        // Crear mensaje flotante
                        createFloatingMessage(`+${points}`, enemy.x, enemy.y);
                        
                        // Efecto de explosión
                        createExplosion(enemy.x, enemy.y, enemy.width);
                        
                        break;
                    }
                }
            }
        }
        
        // Crear efecto de explosión
        function createExplosion(x, y, size) {
            ctx.save();
            ctx.shadowColor = '#ff0';
            ctx.shadowBlur = 20;
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
        
        // Perder una vida
        function loseLife() {
            lives--;
            livesDisplay.textContent = `Vidas: ${lives}`;
            
            // Crear mensaje flotante de pérdida de vida
            createFloatingMessage(`-1`, player.x, player.y);
            
            if (lives <= 0) {
                gameOver();
            }
        }
        
        // Crear mensaje flotante
        function createFloatingMessage(text, x, y) {
            floatingMessages.push({
                text: text,
                x: x,
                y: y,
                opacity: 1,
                speed: -1 // Velocidad de movimiento hacia arriba
            });
        }
        
        // Dibujar mensajes flotantes
        function drawFloatingMessages() {
            for (let i = floatingMessages.length - 1; i >= 0; i--) {
                const message = floatingMessages[i];
                
                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.font = '20px Press Start 2P';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.globalAlpha = message.opacity; // Aplicar opacidad
                ctx.fillText(message.text, message.x + 75, message.y); // Ajustar posición para centrar
                ctx.restore();
                
                // Actualizar posición y opacidad
                message.y += message.speed;
                message.opacity -= 0.02; // Desvanecer el mensaje
                
                // Eliminar mensajes que se han desvanecido
                if (message.opacity <= 0) {
                    floatingMessages.splice(i, 1);
                }
            }
        }
        
        // Disparar
        function shoot() {
            if (!gameActive) return;
            
            const bullet = {
                x: player.x + player.width,
                y: player.y + player.height / 2 - 2.5,
                width: 15,
                height: 5,
                speed: 7
            };
            
            bullets.push(bullet);
        }
        
        // Game Over
        function gameOver() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(enemyInterval);
            
            finalScoreDisplay.textContent = `Puntuación: ${score}`;
            gameOverScreen.style.display = 'flex';
        }
        
        // Event listeners
        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            
            switch(e.key) {
                case 'ArrowUp':
                    upPressed = true;
                    break;
                case 'ArrowDown':
                    downPressed = true;
                    break;
                case ' ':
                    shoot();
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    upPressed = false;
                    break;
                case 'ArrowDown':
                    downPressed = false;
                    break;
            }
        });
        
        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            initGame();
        });
        
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            initGame();
        });
    </script>
</body>
</html>
